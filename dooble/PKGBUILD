# -*- shell-script -*-
# Maintainer:  Mattias Andr√©e

pkgname=dooble
pkgver=1.38
pkgrel=1
pkgdesc='A safe WebKit Web browser'
url=http://dooble.sourceforge.net/
arch=(i686 x86_64)
license=(GPL2)
source=("https://downloads.sourceforge.net/project/dooble/Version%201.38/Dooble_Lin64.tar.gz?r=&ts=1358219172&use_mirror=heanet")
md5sums=(6f38c6981022966791e14e7694c72dd6)
depends=(libpng12)

_sedfiles="dooble.sh qt.conf"

[ "${CARCH}" == 'i686' ] &&
  source[0]="https://downloads.sourceforge.net/project/dooble/Version%201.38/Dooble_Lin32.tar.gz?r=&ts=1358219172&use_mirror=heanet" &&
  md5sums[0]=a19ca86cf5bff9a382bdbdd1e7060225


package()
{
	msg "Moving precompiled files into \$pkgdir"
	
	mv "$srcdir/usr" "$pkgdir"
	
	
	msg "Fixing file structure"
	
	mkdir "$pkgdir/opt"
	mv "$pkgdir/usr/local/dooble" "$pkgdir/opt"
	rmdir "$pkgdir/usr/local/" || echo "Cannot remove \$pkgdir/usr/local/"
	rmdir "$pkgdir/usr/"       || echo "Cannot remove \$pkgdir/usr/"


	msg "Editing files for the file structure modification"
	
	for file in $_sedfiles
	do
	    sed -i s_'/usr/local/dooble'_'/opt/dooble'_g "$pkgdir/opt/dooble/$file"
	done
	
	for file in "Dooble"
	do
            ## hehehe
	    sed -i s_'/usr/local/dooble/Lib\x00'_'/opt/dooble/Lib\x00\x00\x00\x00\x00\x00\x00'_g  "$pkgdir/opt/dooble/$file"
	done
	
	
	msg "Renaming \$pkgdir/opt/dooble/dooble.sh to \$pkgdir/opt/dooble/dooble"
	
	mv "$pkgdir/opt/dooble/dooble.sh" "$pkgdir/opt/dooble/dooble"
}

