# -*- shell-script -*-
# Maintainer:  Mattias Andr√©e

pkgname=dooble
pkgver=1.41
pkgrel=1
pkgdesc='A safe WebKit Web browser'
url=http://dooble.sourceforge.net/
arch=(x86_64)
license=(GPL2)
source=("http://downloads.sourceforge.net/project/dooble/Version%201.41/Dooble_Lin64.tar.gz?r=&ts=1365713519&use_mirror=netcologne")
md5sums=(7f005db2e1a057fe7f5c871855c6e25d)
depends=(libpng12)

_sedfiles="dooble.sh qt.conf"


package()
{
	msg "Moving precompiled files into \$pkgdir"
	
	mv "$srcdir/usr" "$pkgdir"
	
	
	msg "Fixing file structure"
	
	mkdir "$pkgdir/opt"
	mv "$pkgdir/usr/local/dooble" "$pkgdir/opt"
	rmdir "$pkgdir/usr/local/" || echo "Cannot remove \$pkgdir/usr/local/"
	rmdir "$pkgdir/usr/"       || echo "Cannot remove \$pkgdir/usr/"


	msg "Editing files for the file structure modification"
	
	for file in $_sedfiles
	do
	    sed -i s_'/usr/local/dooble'_'/opt/dooble'_g "$pkgdir/opt/dooble/$file"
	done
	
	for file in "Dooble"
	do
            ## hehehe
	    sed -i s_'/usr/local/dooble/Lib\x00'_'/opt/dooble/Lib\x00\x00\x00\x00\x00\x00\x00'_g  "$pkgdir/opt/dooble/$file"
	done
	
	# libudev.so.0 does not exist, but libudev.so.1 works
	sed -i 's_libudev.so.0_libudev.so\x00\x00_g' "$pkgdir/opt/dooble/Lib/libQt5WebKit.so.5"
	sed -i 's_libudev.so.0_libudev.so\x00\x00_g' "$pkgdir/opt/dooble/Plugins/generic/libqevdevtabletplugin.so"
	sed -i 's_libudev.so.0_libudev.so\x00\x00_g' "$pkgdir/opt/dooble/Plugins/generic/libqevdevkeyboardplugin.so"
	sed -i 's_libudev.so.0_libudev.so\x00\x00_g' "$pkgdir/opt/dooble/Plugins/generic/libqevdevtouchplugin.so"
	sed -i 's_libudev.so.0_libudev.so\x00\x00_g' "$pkgdir/opt/dooble/Plugins/generic/libqevdevmouseplugin.so"

	
	
	msg "Renaming \$pkgdir/opt/dooble/dooble.sh to \$pkgdir/opt/dooble/dooble"
	
	mv "$pkgdir/opt/dooble/dooble.sh" "$pkgdir/opt/dooble/dooble"
}

