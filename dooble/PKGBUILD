# Maintainer: Mattias Andr√©e <`base64 -d`(bWFhbmRyZWUK)@member.fsf.org>
pkgname=dooble
pkgver=1.41
pkgrel=2
pkgdesc='A safe WebKit Web browser'
url='http://dooble.sourceforge.net/'
arch=('i386' 'x86_64')
license=('GPL2')
depends=('bzip2' 'expat' 'fontconfig' 'freetype2' 'gcc-libs-multilib' 'glib2' 'glibc' 'gstreamer0.10' 'gstreamer0.10-base'
         'libdrm' 'libffi' 'libgpg-error' 'libice' 'libjpeg-turbo' 'libpng' 'libsm' 'libx11' 'libxau' 'libxcb' 'libxdamage'
         'libxdmcp' 'libxext'  'libxfixes' 'libxml2' 'libxrender' 'libxxf86vm' 'mesa' 'mesa-libgl'  'openssl' 'orc' 'pcre'
         'qt4' 'sqlite' 'udev' 'util-linux' 'xz' 'zlib')
makedepends=('svn')
options=('!emptydirs')


build()
{
    cd "$srcdir"
    svn co "https://dooble.svn.sourceforge.net/svnroot/dooble" dooble
    cd "dooble/trunk/browser/"
    sed -i 's_-Werror__g' dooble.pro
    qmake-qt4 -o Makefile dooble.pro
    make
}

package()
{
    cd "$srcdir/dooble/trunk/browser/"
    make INSTALL_ROOT="$pkgdir" install
    
    msg "Fixing file structure"
    mkdir "$pkgdir/opt"
    mv "$pkgdir/usr/local/dooble" "$pkgdir/opt"
    mv "$pkgdir/usr/local/include" "$pkgdir/usr"
    rmdir "$pkgdir/usr/local/" || echo "Cannot remove \$pkgdir/usr/local/"
    
    msg "Editing files for the file structure modification"
    sed -i s_'/usr/local/dooble'_'/opt/dooble'_g "$pkgdir/opt/dooble/dooble.sh"
    sed -i s_'/usr/local/dooble/Lib\x00'_'/opt/dooble/Lib\x00\x00\x00\x00\x00\x00\x00'_g  "$pkgdir/opt/dooble/Dooble"
    
    msg "Renaming \$pkgdir/opt/dooble/dooble.sh to \$pkgdir/opt/dooble/dooble"
    mv "$pkgdir/opt/dooble/dooble.sh" "$pkgdir/opt/dooble/dooble"
    
    msg "Installing files missed by the installer"
    mkdir -p "$pkgdir/opt/dooble/Lib"
    cp "$srcdir/dooble/trunk/browser/LibSpotOn/libspoton.so" "$pkgdir/opt/dooble/Lib"
}

